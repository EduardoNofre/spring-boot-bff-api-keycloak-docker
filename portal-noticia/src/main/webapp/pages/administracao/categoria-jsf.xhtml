<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<title><ui:insert name="title">Cadastro de Categorias</ui:insert></title>
	<h:outputStylesheet library="css" name="style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8" />
</h:head>


<h:body>

	<!-- Header fixo -->
	<div id="header" class="div-header">
		<h:panelGroup layout="block" style="padding:15px;">
			<h:outputText value="Gerenciamento de categorias" styleClass="titulo-principal-default-1"/><br></br>
			<h:outputText value="As funcionalidades nesta tela são destinadas à administração e ao gerenciamento de categorias." styleClass="titulo-principal-default-2"/>
		</h:panelGroup>
	</div>

	<div class="card crud-demo">
		<h:form id="form-categorias">
			<p:growl id="g-mensagem" showDetail="true" />
			<div id="content"  class="div-table-primcipal-default">
				<div style="min-width: 600px;">
					<p:panel
						style="width: 70%; margin: 0 auto; background-color: #DCDCDC; color: #DCDCDC; border: 2px solid #DCDCDC;">
						<p:toolbar>
							<p:toolbarGroup>
								<p:commandButton 
								value="Nova Categoria" 
								icon="pi pi-plus"
								actionListener="#{categoriaBean.inserirNovaCategoria}"
								update=":form-dialog-edit-cad:manage-categoria-content"
								oncomplete="PF('gerenciadoCategoriaDialog').show()"
								styleClass="ui-button-success"
								style="margin-right: .5rem">								
								<p:resetInput target=":form-dialog-edit-cad:manage-categoria-content" />
								</p:commandButton>

								<p:commandButton 
									id="delete-categorias-button"
									value="#{categoriaBean.deleteButtonMessage}" 
									icon="pi pi-trash"
									actionListener="#{categoriaBean.excluirCategorias}"
									styleClass="ui-button-danger"
									 disabled="#{!categoriaBean.temCategoriaSelecionada()}"  update="@this">
									<p:confirm header="Confirmação"
										message="Deseja excluir as categorias selecionadas?"
										icon="pi pi-exclamation-triangle" />
								</p:commandButton>								
							</p:toolbarGroup>
						</p:toolbar>


						<p:dataTable id="dt-tab-categoria" widgetVar="wgv-categorias"
							var="categoria" value="#{categoriaBean.listarCategorias()}"
							reflow="true" styleClass="categoria-table"
							selection="#{categoriaBean.categoriasSelecionadas}"
							rowKey="#{categoria.id}" paginator="true" rows="10"
							selectionRowMode="add" paginatorPosition="bottom"
							emptyMessage="Nenhuma categoria encontrada.">

							<p:ajax event="rowSelect" update=":form-categorias:delete-categorias-button" />
							<p:ajax event="rowUnselect" update=":form-categorias:delete-categorias-button" />
							<p:ajax event="rowSelectCheckbox" update=":form-categorias:delete-categorias-button" />
							<p:ajax event="rowUnselectCheckbox" update=":form-categorias:delete-categorias-button" />
							<p:ajax event="toggleSelect" update=":form-categorias:delete-categorias-button" />

							<p:column selectionMode="multiple" exportable="false" />

							<p:column headerText="Id">
								<h:outputText value="#{categoria.id}"/>
							</p:column>

							<p:column headerText="Categoria">
								<h:outputText value="#{categoria.categoria}" />
							</p:column>

							<p:column headerText="Descrição">
								<h:outputText value="#{categoria.categoriaDesc}" />
							</p:column>

							<p:column headerText="Criado em">
								<h:outputText value="#{categoria.criadoEm}">
								</h:outputText>
							</p:column>

							<p:column headerText="Última Alteração">
								<h:outputText value="#{categoria.dataHrAlteracao}">
								</h:outputText>
							</p:column>

							<p:column exportable="false" headerText="Ações">
								<p:commandButton icon="pi pi-pencil"
									update=":form-dialog-edit-cad:gerenciador-categoria-content-edit"
									oncomplete="PF('wgv-gerenciadorCategoriaDialogEdit').show()"
									styleClass="edit-button rounded-button ui-button-success"
									process="@this">
									<f:setPropertyActionListener value="#{categoria}"
										target="#{categoriaBean.categoriaSelecionada}" />
									<p:resetInput target=":form-dialog-edit-cad:gerenciador-categoria-content-edit" />
								</p:commandButton>
								<p:commandButton class="ui-button-warning rounded-button"
									icon="pi pi-trash" process="@this"
									oncomplete="PF('deleteCategoriaDialog').show()">
									<f:setPropertyActionListener value="#{categoria}"
										target="#{categoriaBean.categoriaSelecionada}" />
								</p:commandButton>
							</p:column>
						</p:dataTable>
					</p:panel>
				</div>
			</div>
		</h:form>


		<h:form id="form-dialog-edit-cad">
			<!-- Dialog de Cadastro -->
			<p:dialog header="Criar uma Categoria" showEffect="fade" modal="true"
				widgetVar="gerenciadoCategoriaDialog" responsive="true">
				<p:outputPanel id="manage-categoria-content" class="ui-fluid">
					<p:outputPanel
						rendered="#{not empty categoriaBean.dto}">
						<div class="field">
							<p:outputLabel for="categoria">Salvar Categoria</p:outputLabel>
							<p:inputText id="categoria" value="#{categoriaBean.dto.categoria}" />
						</div>
						<div class="field">
							<p:outputLabel for="descricao">Descrição</p:outputLabel> 
							<p:inputTextarea id="descricao" value="#{categoriaBean.dto.categoriaDesc}" autoResize="true"/>
						</div>
					</p:outputPanel>
				</p:outputPanel>

				<f:facet name="footer">
					<p:commandButton value="Salvar" icon="pi pi-check"
						actionListener="#{categoriaBean.salvarCategoria}"
						update=":form-categorias:g-mensagem :form-categorias:dt-tab-categoria"
						process="manage-categoria-content @this" />
					<p:commandButton value="Cancelar" icon="pi pi-times"
						onclick="PF('gerenciadoCategoriaDialog').hide()"
						class="ui-button-secondary" type="button" />
				</f:facet>
			</p:dialog>

			<!-- Dialog de Editar -->
			<p:dialog header="Editar Categoria" showEffect="fade" modal="true"
				widgetVar="wgv-gerenciadorCategoriaDialogEdit" responsive="true">
				<p:outputPanel id="gerenciador-categoria-content-edit" class="ui-fluid">
					<p:outputPanel
						rendered="#{not empty categoriaBean.categoriaSelecionada}">

						<div class="field">
							<p:outputLabel for="categoria">Id categoria</p:outputLabel>
							<p:inputText id="IdEdit"
								value="#{categoriaBean.categoriaSelecionada.id}" required="true" disabled="true" />
						</div>


						<div class="field">
							<p:outputLabel for="categoria">Editar categoria</p:outputLabel>
							<p:inputText id="categoriaEdit"
								value="#{categoriaBean.categoriaSelecionada.categoria}"
								required="true" />
						</div>
						<div class="field">
							<p:outputLabel for="descricao">Descrição</p:outputLabel>
							<p:inputTextarea id="descricaoEdit"
								value="#{categoriaBean.categoriaSelecionada.categoriaDesc}"
								autoResize="true" />
						</div>
					</p:outputPanel>
				</p:outputPanel>

				<f:facet name="footer">
					<p:commandButton value="editar" icon="pi pi-check"
						actionListener="#{categoriaBean.editarCategoria}"
						update=":form-categorias:g-mensagem :form-categorias:dt-tab-categoria"
						process="gerenciador-categoria-content-edit @this" />
					<p:commandButton value="Cancelar" icon="pi pi-times"
						onclick="PF('wgv-gerenciadorCategoriaDialogEdit').hide()"
						class="ui-button-secondary" type="button" />
				</f:facet>

			</p:dialog>

		<!-- Confirmação de exclusão multi select categorias -->
        <p:confirmDialog global="true" showEffect="fade" width="300">
            <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-secondary"
                icon="pi pi-times" />
        </p:confirmDialog>
        
			<!-- Confirmação de exclusão do botão da linha da tabela -->
			<p:confirmDialog widgetVar="deleteCategoriaDialog"  showEffect="fade" width="300" message="Excluir esta categoria?" header="Confirmação" severity="warn">
				<p:commandButton value="Sim" icon="pi pi-check" actionListener="#{categoriaBean.excluirCategoria}" process="@this" update=":form-categorias:g-mensagem :form-categorias:dt-tab-categoria" oncomplete="PF('deleteCategoriaDialog').hide()" />
				<p:commandButton value="Não" type="button" styleClass="ui-button-secondary" icon="pi pi-times" onclick="PF('deleteCategoriaDialog').hide()" />
			</p:confirmDialog>
		</h:form>
	</div>

	<!-- Footer fixo -->
	<div id="footer" class="div-footer">
		<h:panelGroup layout="block" style="padding:10px; text-align:center;">
			<h:outputText
				value="© 2025 Nofre Reis. Todos os direitos reservados." />
		</h:panelGroup>
	</div>
</h:body>
</html>
